<?php

//set the start time so we can calculate how long it takes to load the page.
$mtime1 = explode(" ", microtime());
$starttime = $mtime1[0] + $mtime1[1];

$transacao = "FICOMPENSA";
require_once "../common/config.php";
require_once "../common/config.financeiro.php";
require_once "../common/common.financeiro.php";
require_once "../common/common.php";
require_once "../common/config.gvendas.php";

require "../common/login.php";

?>
<html>
<head>
<title>Financeiro</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link href="../common/relatorios/blue.css" rel="stylesheet" type="text/css">
<link href="../../Intranet_Style.css" rel="stylesheet" type="text/css">
<BODY leftmargin="0" topmargin="0" rightmargin="0" bottommargin="0" marginwidth="0" marginheight="0" class=body>
<SCRIPT language=JavaScript src="../menu/menu_financeiro.js" type=text/javascript></SCRIPT>
<SCRIPT language=JavaScript src="../menu/mmenu.js" type=text/javascript></SCRIPT>
<SCRIPT LANGUAGE="JavaScript">
	function small_window(myurl) {
	var newWindow;
	var props = 'scrollBars=yes,resizable=yes,toolbar=no,menubar=no,location=no,directories=no,width=400,height=350';
	newWindow = window.open(myurl, "Add_from_Src_to_Dest", props);
	}
	function small_window2(myurl,tela) {
		var newWindow;
		var props = 'scrollBars=yes,resizable=yes,toolbar=yes,menubar=no,location=no,directories=no,width=680,height=400';
		newWindow = window.open(myurl, tela, props);
	}
	function addToParentList(sourceList) {
		window.document.forms[0].cod.value = sourceList;
	}
</script>
<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0">
  <tr> 
    <td width="20"><img src="../images/financeirobarra1.gif" height="32"></td>
    <td width="100%"><img src="../images/fundoverdeclaro.gif" width="100%" height="32"></td>
    <td width=69 ><img src="../images/barravaledouradoverdeclaro.gif" width="108" height="32"></td>
  </tr>
</table>
<br><br>
<table border="0" align="center">
  <tr> 
    <td align="center"><b>Dados Mestres -> Compensação gerar arquivo</b></td>
  </tr>
  <tr> 
    <td><br></td>
  </tr>
</table>
<?
if($act == "sqldelete") {
	$sql = "INSERT INTO $mysql_complog2_table select *,'$motivo','$cookie_name','".date('Y-m-d h:i:s')."' from $mysql_complog_table where datacomp = '".datatobanco($rsin2)."' and nomecomp = '$nomecomp2'";
	$result = execsql($sql);
	$sql = "DELETE FROM $mysql_complog_table where datacomp = '".datatobanco($rsin2)."' and nomecomp = '$nomecomp2'";
	$result = execsql($sql);
}

if ($rsin && !isset($nomecomp)) {
?>
	<table border="1" bordercolor="black" cellpadding="2" cellspacing="0" align="center" width="500">
		<tr class="tdsubcabecalho2"> 
		  <td align="center"><font size="0"><b>Nome</b></td>
		  <td align="center"><font size="0"><b>Usuário</b></td>
		  <td align="center"><font size="0"><b>Dt. Compensação</b></td>
		  <td align="center"><font size="0"><b>Dt. Log</b></td>
		</tr>
<? 
	$sql = "select nomecomp, usuario, DATE_FORMAT(datausuario,'%d/%m/%Y'), DATE_FORMAT(datasys,'%d/%m/%Y %H:%i:%s') from $mysql_complog_table where datacomp = '".datatobanco($rsin)."' group by nomecomp order by nomecomp";
	$result = execsql($sql);
	while($row = mysql_fetch_row($result)) {
		echo '
			<tr class="tddetalhe1"> 
			  <td align="center"><font size="0"><a href="?rsin='.$rsin.'&nomecomp='.$row[0].'">'.$row[0].'</a></td>
			  <td align="center"><font size="0">'.$row[1].'</td>
			  <td align="center"><font size="0">'.$row[2].'</td>
			  <td align="center"><font size="0">'.$row[3].'</td>
			</tr>';
		}
	echo "</table>";

} elseif ($nomecomp != "") {

	if ($act == "delete") {
	?>
		<table width="580" border="0" align="center">
		  <tr> 
			<td align="center" class="tdcabecalho1"><b>Deletar Compensação</b></td>
		  </tr>
		  <tr>
			<td align="center" bgcolor="#F5F5F5"><form name="adicionar" method="post" action="comparquivo.php">
			  <table border="0" align="center" width="95%">
				<tr> 
				  <td width="100" align="right" class="tdsubcabecalho1"><b>Nome: </b></td>
				  <td><?=$nomecomp?></td>
				  <td width="100" align="right" class="tdsubcabecalho1"><b>Data: </b></td>
				  <td><?=$rsin?></td>
				</tr>
				<tr> 
				  <td width="100" align="right" class="tdsubcabecalho1"><b>Motivo: </b></td>
				  <td colspan="3"><input name="motivo" size="75"></td>
				</tr>
				<tr height="22">
				  <td colspan="5"><br>
					  <table border="0" align="center" width="100%">
					  <tr><td align="left" width="33%"></td><td align="center" width="33%"><input name="salvar" type="image" src="images/btdeletar.gif"></td><td align="right" width="33%"></td></tr>
					  </table>
				  </td>
				</tr>
			  </table>
			</td>
		  </tr>
		</table>
		<input type=hidden name=act value="sqldelete" size=20>
		<input type=hidden name=nomecomp2 value="<?=$nomecomp?>" size=20>
		<input type=hidden name=rsin2 value="<?=$rsin?>" size=20>
		</form>

	<?
	}

	$sql = "select * from $mysql_compensacao_table a
	LEFT JOIN $mysql_complog_table b ON a.idcomp = b.idcomp where b.idcomp=a.idcomp and datacomp = '".datatobanco($rsin)."' and nomecomp = '$nomecomp'
	order by a.codfilial, a.loja";
	$result = execsql($sql);
	$num_rows = mysql_num_rows($result);
	if ($num_rows == 0) { 
		erro("Nenhuma compensação para esta data!");
	} else {
?>
	<table border="0" align="center">
	  <tr>
		<td align="center" class="tdfundo" colspan="3">
		<table border="1" bordercolor="black" cellpadding="2" cellspacing="0">
			<tr class="tdsubcabecalho2"> 
			  <td align="center" colspan="3"><font size="0"><b>Cliente</b></td>
			  <td align="center" colspan="4"><font size="0"><b>Nota Fiscal</b></td>
			  <td align="center" colspan="2"><font size="0"><b>Desconto</b></td>
			  <td align="center" colspan="2"><font size="0"><b>Acordo</b></td>
			  <td align="center" colspan="2"><font size="0"><b>Dif. Preço</b></td>
			  <td align="center" colspan="1"><font size="0"><b>Diverso</b></td>
			  <td align="center" colspan="2"><font size="0"><b>Jrs. Antec.</b></td>
			  <td align="center" colspan="2"><font size="0"><b>Total</b></td>
			</tr>
			<tr class="tdsubcabecalho2"> 
			  <td align="center"><font size="0"><b>Filial</b></td>
			  <td align="center"><font size="0"><b>Loja</b></td>
			  <td align="center"><font size="0"><b>Cód</b></td>
			  <td align="center"><font size="0"><b>Nº</b></td>
			  <td align="center"><font size="0"><b>Tipo</b></td>
			  <td align="center"><font size="0"><b>Sit</b></td>
			  <td align="center"><font size="0"><b>Valor</b></td>
			  <td align="center"><font size="0"><b>Valor</b></td>
			  <td align="center"><font size="0"><b>%</b></td>
			  <td align="center"><font size="0"><b>Valor</b></td>
			  <td align="center"><font size="0"><b>%</b></td>
			  <td align="center"><font size="0"><b>Valor</b></td>
			  <td align="center"><font size="0"><b>%</b></td>
			  <td align="center"><font size="0"><b>Valor</b></td>
			  <td align="center"><font size="0"><b>Valor</b></td>
			  <td align="center"><font size="0"><b>%</b></td>
			  <td align="center"><font size="0"><b>Valor</b></td>
			  <td align="center"><font size="0"><b>%</b></td>
			</tr>
	<? 
	$filial = "&nbsp;";
	while($row = mysql_fetch_row($result)) {
		if ($filial != $row[1] && $filial != "&nbsp;") {
			$total = $vdesc+$vdiv+$vja;
			$cc = getfilialcc($filial); 

			echo '
				<tr class="tdsubcabecalho1"> 
				  <td align="center"><font size="0">'.$cc[1].'</td>
				  <td align="center"><font size="0">&nbsp;</td>
				  <td align="center"><font size="0">&nbsp;</td>
				  <td align="center"><font size="0">'.$cc[2].'</td>
				  <td align="center"><font size="0">CC</td>
				  <td align="center"><font size="0">*</td>
				  <td align="right"><font size="0">'.number_format($vnf,'2',',','.').'</td>
				  <td align="right"><font size="0">'.number_format($vdesc,'2',',','.').'</td>
				  <td align="right"><font size="0">'.porcento($vdesc,$vnf).'</td>
				  <td align="right"><font size="0">'.number_format($vacordo,'2',',','.').'</td>
				  <td align="right"><font size="0">'.porcento($vacordo,$vnf).'</td>
				  <td align="right"><font size="0">'.number_format($vdp,'2',',','.').'</td>  
				  <td align="right"><font size="0">'.porcento($vdp,$vnf).'</td>
				  <td align="right"><font size="0">'.number_format($vdiv,'2',',','.').'</td>  
				  <td align="right"><font size="0">'.number_format($vja,'2',',','.').'</td>  
				  <td align="right"><font size="0">'.porcento($vja,$vnf).'</td>
				  <td align="right"><font size="0">'.number_format($total,'2',',','.').'</td> 
				  <td align="right"><font size="0">'.porcento($total,$vnf).'</td>
				</tr>';

			$item .= $cc[1].";; ;".$cc[2].";CC;*;".number_format($vnf,'2',',','.').";".number_format($vdesc,'2',',','.').";".porcento($vdesc,$vnf).";".number_format($vacordo,'2',',','.').";".porcento($vacordo,$vnf).";".number_format($vdp,'2',',','.').";".porcento($vdp,$vnf).";".number_format($vdiv,'2',',','.').";".number_format($vja,'2',',','.').";".porcento($vja,$vnf).";".number_format($total,'2',',','.').";".porcento($total,$vnf).";;;;;0,00%;;;;;;;;;;;;;;;;;;;;
";

			$vnf = 0;
			$vdesc = 0;	
			$vacordo = 0;
			$vdp = 0;	
			$vdiv = 0;	
			$vja = 0;	
		}
		$total = $row[8]+$row[11]+$row[12];
		$vnf += $row[7];	 $vtnf += $row[7];	
		$vdesc += $row[8];	 $vtdesc += $row[8];	
		$vacordo += $row[9]; $vtacordo += $row[9];
		$vdp += $row[10];	 $vtdp += $row[10];	
		$vdiv += $row[11];	 $vtdiv += $row[11];	
		$vja += $row[12];	 $vtja += $row[12];	

		echo '
			<tr> 
			  <td align="center"><font size="0">'.$row[1].'</td>
			  <td align="center"><font size="0">'.$row[2].'</td>
			  <td align="center"><font size="0">'.$row[3].'</td>
			  <td align="center"><font size="0">';

			echo '<a href=javascript:small_window2("compdetalhe.php?idcomp='.$row[0].'")>';
			
			echo $row[4].'</a></td>
			  <td align="center"><font size="0">'.$row[5].'</td>
			  <td align="center"><font size="0">'.$row[6].'</td>
			  <td align="right"><font size="0">'.number_format($row[7],'2',',','.').'</td>
			  <td align="right"><font size="0">'.number_format($row[8],'2',',','.').'</td>
			  <td align="right"><font size="0">'.porcento($row[8],$row[7]).'</td>
			  <td align="right"><font size="0">'.number_format($row[9],'2',',','.').'</td>
			  <td align="right"><font size="0">'.porcento($row[9],$row[7]).'</td>
			  <td align="right"><font size="0">'.number_format($row[10],'2',',','.').'</td>
			  <td align="right"><font size="0">'.porcento($row[10],$row[7]).'</td>
			  <td align="right"><font size="0">'.number_format($row[11],'2',',','.').'</td>
			  <td align="right"><font size="0">'.number_format($row[12],'2',',','.').'</td>
			  <td align="right"><font size="0">'.porcento($row[12],$row[7]).'</td>
			  <td align="right"><font size="0">'.number_format($total,'2',',','.').'</td>
			  <td align="right"><font size="0">'.porcento($total,$row[7]).'</td>
			</tr>';

	    	$lj  = substr($row[2],0,1);
		    $lj2 = substr($row[2],1,1);

			$item .= $row[1].";".$row[2].";".$row[3].";".$row[4].";".$row[5].";".$row[6].";".number_format($row[7],'2',',','.').";".number_format($row[8],'2',',','.').";".porcento($row[8],$row[7]).";".number_format($row[9],'2',',','.').";".porcento($row[9],$row[7]).";".number_format($row[10],'2',',','.').";".porcento($row[10],$row[7]).";".number_format($row[11],'2',',','.').";".number_format($row[12],'2',',','.').";".porcento($row[12],$row[7]).";".number_format($total,'2',',','.').";".porcento($total,$row[7]).";;;;;0,00%;;;;;;;;;;;;;;;;;;;;
";

		if ($row[7] < 0) {
			$vdevolucao += $row[7];
		}

		$filial = $row[1];
	}
		$cc = getfilialcc($filial);
		$total = $vdesc+$vdiv+$vja;
	echo '
		<tr class="tdsubcabecalho1"> 
		  <td align="center"><font size="0">'.$cc[1].'</td>
		  <td align="center"><font size="0">&nbsp;</td>
		  <td align="center"><font size="0">&nbsp;</td>
		  <td align="center"><font size="0">'.$cc[2].'</td>
		  <td align="center"><font size="0">CC</td>
		  <td align="center"><font size="0">*</td>
		  <td align="right"><font size="0">'.number_format($vnf,'2',',','.').'</td>
		  <td align="right"><font size="0">'.number_format($vdesc,'2',',','.').'</td>
		  <td align="right"><font size="0">'.porcento($vdesc,$vnf).'</td>
		  <td align="right"><font size="0">'.number_format($vacordo,'2',',','.').'</td>
		  <td align="right"><font size="0">'.porcento($vacordo,$vnf).'</td>
		  <td align="right"><font size="0">'.number_format($vdp,'2',',','.').'</td>  
		  <td align="right"><font size="0">'.porcento($vdp,$vnf).'</td>
		  <td align="right"><font size="0">'.number_format($vdiv,'2',',','.').'</td>  
		  <td align="right"><font size="0">'.number_format($vja,'2',',','.').'</td>  
		  <td align="right"><font size="0">'.porcento($vja,$vnf).'</td>
		  <td align="right"><font size="0">'.number_format($total,'2',',','.').'</td> 
		  <td align="right"><font size="0">'.porcento($total,$vnf).'</td>
		</tr>';
		$item .= $cc[1].";; ;".$cc[2].";CC;*;".number_format($vnf,'2',',','.').";".number_format($vdesc,'2',',','.').";".porcento($vdesc,$vnf).";".number_format($vacordo,'2',',','.').";".porcento($vacordo,$vnf).";".number_format($vdp,'2',',','.').";".porcento($vdp,$vnf).";".number_format($vdiv,'2',',','.').";".number_format($vja,'2',',','.').";".porcento($vja,$vnf).";".number_format($total,'2',',','.').";".porcento($total,$vnf).";;;;;0,00%;;;;;;;;;;;;;;;;;;;;
";

		$total = $vtdesc+$vtdp+$vtdiv+$vtja;
	echo '
		<tr class="tdcabecalho2"> 
		  <td align="center" colspan="6"><font size="0">TOTAL GERAL</td>
		  <td align="right"><font size="0">'.number_format($vtnf,'2',',','.').'</td>
		  <td align="right"><font size="0">'.number_format($vtdesc,'2',',','.').'</td>
		  <td align="right"><font size="0">'.porcento($vdesc,$vtnf).'</td>
		  <td align="right"><font size="0">'.number_format($vtacordo,'2',',','.').'</td>
		  <td align="right"><font size="0">'.porcento($vtacordo,$vtnf).'</td>
		  <td align="right"><font size="0">'.number_format($vtdp,'2',',','.').'</td>  
		  <td align="right"><font size="0">'.porcento($vtdp,$vtnf).'</td>
		  <td align="right"><font size="0">'.number_format($vtdiv,'2',',','.').'</td>  
		  <td align="right"><font size="0">'.number_format($vtja,'2',',','.').'</td>  
		  <td align="right"><font size="0">'.porcento($vtja,$vtnf).'</td>
		  <td align="right"><font size="0">'.number_format($total,'2',',','.').'</td> 
		  <td align="right"><font size="0">'.porcento($total,$vtnf).'</td>
		</tr>';
	?>

		  </table>
		  </td>
	  </tr>
	  <tr>
		<td align="center" class="tdfundo" colspan="3"><br>
		<table width="50%" border="1" bordercolor="black" cellpadding="2" cellspacing="0">
			<tr class="tdsubcabecalho2"> 
			  <td align="center" colspan="2"><font size="0">Lançamentos</td>
			</tr>
			<tr><td align="right" class="tdsubcabecalho1"><font size="0">Banco:</td><td align="right" class="tddetalhe2"><font size="0"><?=number_format($vtnf-$vtja-$vtdp-$vtdesc-$vtdiv-$vtacordo,'2',',','.')?></td></tr>
			<tr><td align="right" class="tdsubcabecalho1"><font size="0">Juros s/Ant.:</td><td align="right" class="tddetalhe2"><font size="0"><?=number_format($vtja,'2',',','.')?></td></tr>
			<tr><td align="right" class="tdsubcabecalho1"><font size="0">Desc. Comercial:</td><td align="right" class="tddetalhe2"><font size="0"><?=number_format($vtdp+$vtdesc,'2',',','.')?></td></tr>
			<tr><td align="right" class="tdsubcabecalho1"><font size="0">Abatim. Crédito:</td><td align="right" class="tddetalhe2"><font size="0"><?=number_format($vtacordo,'2',',','.')?></td></tr>
			<tr><td align="right" class="tdsubcabecalho1"><font size="0">Diversos:</td><td align="right" class="tddetalhe2"><font size="0"><?=number_format($vtdiv,'2',',','.')?></td></tr>
			<tr><td align="right" class="tdsubcabecalho2"><font size="0">Tot. Parcial:</td><td align="right" class="tddetalhe1"><font size="0"><?=number_format($vtnf,'2',',','.')?></td></tr>
			<tr><td align="right" class="tdsubcabecalho1"><font size="0">Devoluções:</td><td align="right" class="tddetalhe2"><font size="0"><?=number_format($vdevolucao,'2',',','.')?></td></tr>
			<tr><td align="right" class="tdsubcabecalho1"><font size="0">Baixa dos Títulos:</td><td align="right" class="tddetalhe2"><font size="0"><?=number_format($vtnf-$vdevolucao,'2',',','.')?></td></tr>
		</table>
	  </td>
	  </tr>
	  <tr>
		<td align="center" class="tdfundo" colspan="3"><br>
		  <table border="1" bordercolor="black" cellpadding="2" cellspacing="0" width="100%">
			<tr class="tdsubcabecalho2"> 
			  <td align="center"><font size="0"><b>Nota Fiscal</b></td>
			  <td align="center"><font size="0"><b>Log</b></td>
			</tr>

<?
	$sql = "select nfn, log from $mysql_compensacao_table a
    LEFT JOIN $mysql_complog_table b ON b.idcomp = a.idcomp
	where b.idcomp=a.idcomp and datacomp = '".datatobanco($rsin)."' and nomecomp = '$nomecomp'
	order by a.codfilial, a.loja";
	$result = execsql($sql);
	while($row = mysql_fetch_row($result)) {
		if ($row[1] != "") {
		echo '
			<tr> 
			  <td align="center"><font size="0">'.$row[0].'</td>
			  <td align="left"><font size="0">'.$row[1].'</td>
			</tr>';
		}
	}
?>
		  </table>
	    </td>
	  </tr>
	  <tr>
		  <td align="center" width="33%"><br><a href="compensacao.txt"><img src="images/salvar.gif" border="0"><br> <font size="0">Salvar</font></a></td>
		  <td align="center" width="33%"><br><a href="javascript:small_window2('compimprimir.php?rsin=<?=$rsin?>&nomecomp=<?=$nomecomp?>');"><img src="images/imprimir.gif" border="0"><br><font size="0">Imprimir</font></a></td>
		  <td align="center" width="33%"><br><a href="?rsin=<?=$rsin?>&nomecomp=<?=$nomecomp?>&act=delete"><img src="images/erro.gif" border="0"><br><font size="0">Cancelar</font></a></td>
	  </tr>
	</table>

	
	<?
	$sql = "select DATE_FORMAT(datausuario,'%d/%m/%Y') from $mysql_compensacao_table a
	LEFT JOIN $mysql_complog_table b ON a.idcomp = b.idcomp
	where b.idcomp=a.idcomp and datacomp = '".datatobanco($rsin)."' and nomecomp = '$nomecomp'
	order by a.codfilial, a.loja";
	$result2 = execsql($sql);
	$dt = mysql_fetch_row($result2);
	$cabecalho = ";;;;;   ;REDE ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;DATA DA OPERAÇÃO :;;;".$dt[0].";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;ABATIMENTO;;;;;;;;;;;DESCONTO COMERCIAL;;;DEVOLUÇÃO;;;;;;;;;;;;;;;;;;;;;
FILIAL;Loja;Código;Nota Fiscal;;;;Desconto;;Acordo;;Diferença Preço;;Diverso;Jrs.Antecipação;;Total;;% Desc Cf Contrato;Diferença;;Pendente no Sap;Fatura;;;;;;;;;;;;;;;;;;;;
;;;Nº;Tip;Sit;Valor;Valor;%;Valor;%;Valor;%;Valor;Valor;%;Valor;%;;%;Valor;;%;;;;;;;;;;;;;;;;;;;;
";


	$myfile = fopen("compensacao.txt","w");					// Cria o arquivo temporário que ira ser enviado
	$fp = fwrite($myfile,$cabecalho.$item);
	fclose($myfile);

  	}
} else {
?>

<LINK href="../common/calendar.css" type="text/css" rel=stylesheet>
<SCRIPT src="../common/calendar.js" type="text/javascript"></SCRIPT>
<table width="580" border="0" align="center">
  <tr> 
    <td align="center" class="tdcabecalho"><b>Seleção Compensação da Rede</b></td>
  </tr>
  <tr>
    <td align="center" class="tdfundo"><form name="comprede" method="post">
 	  <table border="0" width="80%" align="center">
        <tr> 
          <td align="right" class="tdsubcabecalho1"><b>Data: </b></td>
          <td>
			<input type="text" id="rsin" name="rsin" value="<?=date("d/m/Y")?>" size="11" onFocus="javascript:vDateType='3';" onKeyUp="DateFormat(this,this.value,event,false,'3');" onBlur="DateFormat(this,this.value,event,true,'3');">
			<INPUT onclick="return showCalendar('rsin', 'dd/mm/y');" type=reset value=" ... ">
		  </td>
		</tr>

        <tr height="22">
          <td colspan="4"><br>
		 	  <table border="0" align="center" width="100%">
			  <tr><td align="left" width="33%"><a href="index.php"><img src="images/btvoltar.gif" border="0"></a></td><td align="right" width="33%"><input name="filialmesano" type="image" src="images/btavancar.gif" border="0"></td></tr>
			  </table>
		  </td>
        </tr></form>
      </table>
	</td>
  </tr>
</table>


<SCRIPT type=text/javascript>
Calendar._DN = new Array
("Domingo",
 "Segunda-feira",
 "Terça-feira",
 "Quarta-feira",
 "Quinta-feira",
 "Sexta-feira",
 "Sábado",
 "Domingo");
Calendar._MN = new Array
("Janeiro",
 "Fevereiro",
 "Março",
 "Abril",
 "Maio",
 "Junho",
 "Julho",
 "Agosto",
 "Setembro",
 "Outubro",
 "Novembro",
 "Dezembro");

Calendar._TT = {};
Calendar._TT["TOGGLE"] = "Mudar o primeiro dia da semana";
Calendar._TT["PREV_YEAR"] = "Voltar ano";
Calendar._TT["PREV_MONTH"] = "Voltar mês";
Calendar._TT["GO_TODAY"] = "Voltar para a data atual";
Calendar._TT["NEXT_MONTH"] = "Próximo mês";
Calendar._TT["NEXT_YEAR"] = "Próximo ano";
Calendar._TT["SEL_DATE"] = "Selecionar data";
Calendar._TT["DRAG_TO_MOVE"] = "Mover janela";
Calendar._TT["PART_TODAY"] = " (hoje)";
Calendar._TT["MON_FIRST"] = "Mostrar primeiro segunda";
Calendar._TT["SUN_FIRST"] = "Mostrar primeiro domingo";
Calendar._TT["CLOSE"] = "Fechar";
Calendar._TT["TODAY"] = "Hoje";
</SCRIPT>

<SCRIPT type=text/javascript>
var calendar = null; // remember the calendar object so that we reuse it and
                     // avoid creation other calendars.

// code from http://www.meyerweb.com -- change the active stylesheet.
function setActiveStyleSheet(title) {
  var i, a, main;
  for(i=0; (a = document.getElementsByTagName("link")[i]); i++) {
    if(a.getAttribute("rel").indexOf("style") != -1 && a.getAttribute("title")) {
      a.disabled = true;
      if(a.getAttribute("title") == title) a.disabled = false;
    }
  }
  document.getElementById("style").innerHTML = title;
  return false;
}

// This function gets called when the end-user clicks on some date.
function selected(cal, date) {
  cal.sel.value = date; // just update the date in the input field.
  cal.sel.focus();

    // if we add this call we close the calendar on single-click.
    // just to exemplify both cases, we are using this only for the 1st
    // and the 3rd field, while 2nd and 4th will still require double-click.
    cal.callCloseHandler();
}

// And this gets called when the end-user clicks on the _selected_ date,
// or clicks on the "Close" button.  It just hides the calendar without
// destroying it.
function closeHandler(cal) {
  cal.hide();                        // hide the calendar

  // don't check mousedown on document anymore (used to be able to hide the
  // calendar when someone clicks outside it, see the showCalendar function).
  Calendar.removeEvent(document, "mousedown", checkCalendar);
}

// This gets called when the user presses a mouse button anywhere in the
// document, if the calendar is shown.  If the click was outside the open
// calendar this function closes it.
function checkCalendar(ev) {
  var el = Calendar.is_ie ? Calendar.getElement(ev) : Calendar.getTargetElement(ev);
  for (; el != null; el = el.parentNode)
    // FIXME: allow end-user to click some link without closing the
    // calendar.  Good to see real-time stylesheet change :)
    if (el == calendar.element || el.tagName == "A") break;
  if (el == null) {
    // calls closeHandler which should hide the calendar.
    calendar.callCloseHandler();
    Calendar.stopEvent(ev);
  }
}

// This function shows the calendar under the element having the given id.
// It takes care of catching "mousedown" signals on document and hiding the
// calendar if the click was outside.
function showCalendar(id, format) {
  var el = document.getElementById(id);
  if (calendar != null) {
    // we already have some calendar created
    calendar.hide();                 // so we hide it first.
  } else {
    // first-time call, create the calendar.
    var cal = new Calendar(true, null, selected, closeHandler);
    calendar = cal;                  // remember it in the global var
    cal.setRange(1900, 2070);        // min/max year allowed.
    cal.create();
  }
  calendar.setDateFormat(format);    // set the specified date format
  calendar.parseDate(el.value);      // try to parse the text in field
  calendar.sel = el;                 // inform it what input field we use
  calendar.showAtElement(el);        // show the calendar below it

  // catch "mousedown" on document
  Calendar.addEvent(document, "mousedown", checkCalendar);
  return false;
}

var MINUTE = 60 * 1000;
var HOUR = 60 * MINUTE;
var DAY = 24 * HOUR;
var WEEK = 7 * DAY;

// If this handler returns true then the "date" given as
// parameter will be disabled.  In this example we enable
// only days within a range of 10 days from the current
// date.
// You can use the functions date.getFullYear() -- returns the year
// as 4 digit number, date.getMonth() -- returns the month as 0..11,
// and date.getDate() -- returns the date of the month as 1..31, to
// make heavy calculations here.  However, beware that this function
// should be very fast, as it is called for each day in a month when
// the calendar is (re)constructed.
function isDisabled(date) {
  var today = new Date();
  return (Math.abs(date.getTime() - today.getTime()) / DAY) > 10;
}

function flatSelected(cal, date) {
  var el = document.getElementById("preview");
  el.innerHTML = date;
}

function showFlatCalendar() {
  var parent = document.getElementById("display");

  // construct a calendar giving only the "selected" handler.
  var cal = new Calendar(true, null, flatSelected);

  // We want some dates to be disabled; see function isDisabled above
  cal.setDisabledHandler(isDisabled);
  cal.setDateFormat("DD, MM d");

  // this call must be the last as it might use data initialized above; if
  // we specify a parent, as opposite to the "showCalendar" function above,
  // then we create a flat calendar -- not popup.  Hidden, though, but...
  cal.create(parent);

  // ... we can show it here.
  cal.show();
}
</SCRIPT>

<? 
}

function porcento($vreal,$vmeta) {
	if ($vreal == '0.00' or $vreal == '') $vreal = '0';
	if ($vmeta == '0.00' or $vmeta == '') $vmeta = '1';
	if ((100*$vreal/$vmeta) > 999) $porcentagem = "999.99"; 
	elseif ((100*$vreal/$vmeta) < 0) $porcentagem = "0";
	else $porcentagem = (100*$vreal/$vmeta);

	return number_format($porcentagem,'2',',','.');
}
	
	$mtime2 = explode(" ", microtime());
	$endtime = $mtime2[0] + $mtime2[1];
	$totaltime = $endtime - $starttime;
	$totaltime = number_format($totaltime, 7);

	echo "<br><center><font size=1>$nomefinanceiro<br>";
	echo "Gerência de Tecnologia da Informação - </b> v$versaofinanceiro<br>";
	echo "Processado em: $totaltime segundos, $queries Queries<br>";
	echo "</font> </center>";
?>